<!-- <div>

  <h1 class="display-3 text-center heading my-3">Patient Bill</h1>

  <div *ngIf="!post" novalidate>
      <form [formGroup]="formGroup" (ngSubmit)="onSubmit(formGroup.value)" class="form mx-auto">


          <mat-form-field appearance="outline" class="form-element">
              <mat-label>Name</mat-label>
              <input matInput placeholder="Name" value={{inputname}} formControlName="name">
              <mat-error *ngIf="!formGroup.controls['name'].valid && formGroup.controls['name'].touched">
                  {{ getErrorUsername() }}
              </mat-error>
          </mat-form-field>


          <mat-form-field appearance="outline" class="form-element">
              <mat-label>Gender</mat-label>
              <input matInput placeholder="Gender" value={{inputgender}} formControlName="gender">
              <mat-error *ngIf="formGroup.controls['gender'].touched">
                  {{ titleAlert }}
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-element">
              <mat-label>Age</mat-label>
              <input matInput placeholder="Age" value={{inputage}} formControlName="age">
              <mat-error *ngIf="formGroup.controls['age'].touched">
                  {{ titleAlert }}
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-element">
              <mat-label>Doctor Name</mat-label>
              <input matInput placeholder="Doctor Name" value={{inputdoctor}} formControlName="doctor_name">
              <mat-error *ngIf="formGroup.controls['doctor_name'].touched">
                  {{ titleAlert }}
              </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-element">
            <mat-label>Patient ID</mat-label>
            <input matInput placeholder="Doctor Name" value={{allocateid}} formControlName="allocateid">
            <mat-error *ngIf="formGroup.controls['allocateid'].touched">
                {{ titleAlert }}
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-element">
            <mat-label>medicines</mat-label>
            <input matInput placeholder="medicines" formControlName="medicines">
            <mat-error *ngIf="formGroup.controls['medicines'].touched">
                {{ titleAlert }}
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-element">
            <mat-label>Lab charges</mat-label>
            <input matInput placeholder="Lab charges" formControlName="labcharges">
            <mat-error *ngIf="formGroup.controls['labcharges'].touched">
                {{ titleAlert }}
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-element">
            <mat-label>Next Visit</mat-label>
            <input matInput placeholder="Next Visit" formControlName="nextvisit">
            <mat-error *ngIf="formGroup.controls['nextvisit'].touched">
                {{ titleAlert }}
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-element">
            <mat-label>Advice</mat-label>
            <input matInput placeholder="Advice" formControlName="advice">
            <mat-error *ngIf="formGroup.controls['advice'].touched">
                {{ titleAlert }}
            </mat-error>
        </mat-form-field>

          <div class="form-element">
              <button mat-raised-button color="primary" type="submit" class="button"
                  [disabled]="!formGroup.valid">Submit</button>
          </div>

          <div class="form-element">
              <button mat-raised-button color="primary" type="submit" class="button"
                  (click)="handleEvent()">Cancel</button>
          </div>
          <div class="alert alert-success" role="alert" *ngIf="showSuccess">
              User Created Successfully
          </div>
          <div class="alert alert-danger" role="alert" *ngIf="showError">
              {{ errorString }}
          </div>

      </form>
  </div>
</div> -->


<div>
    <mat-dialog-actions style=" margin-top: -20px">
        <span style="display:flex; justify-content:flex-end; width:100%; padding:0;">
            <button mat-icon-button mat-dialog-close>
                <mat-icon>close</mat-icon>
            </button>
        </span>
    </mat-dialog-actions>

    <hr>
    <mat-tab-group dynamicHeight>
        <!-- <mat-tab>
            <ng-template mat-tab-label>
                <mat-icon class="example-tab-icon">science</mat-icon>
                Add Bill
            </ng-template>
            <div *ngIf="!post" novalidate>
                <form [formGroup]="formGroup" (ngSubmit)="onSubmit(formGroup.value)" class="form mx-auto">

                    <div class="container-fluid">
                        <mat-dialog-content>
                            <div class="row">
                                <div class="col-md-6">
                                    <mat-list role="list">
                                        <mat-list-item role="listitem">
                                            <strong matline>Name:&nbsp;</strong>
                                            <span matline>{{inputname}}</span>
                                        </mat-list-item>
                                        <mat-list-item role="listitem">
                                            <strong matline>Gender:&nbsp;</strong>
                                            <span matline>{{inputgender}}</span>
                                        </mat-list-item>
                                    </mat-list>
                                </div>
                                <div class="col-md-6">
                                    <mat-list role="list">
                                        <mat-list-item role="listitem">
                                            <strong matline>Age:&nbsp;</strong>
                                            <span matline>{{inputage}}</span>
                                        </mat-list-item>
                                        <mat-list-item role="listitem">
                                            <strong matline>Doctor Name:&nbsp;</strong>
                                            <span matline>Dr.{{inputdoctor}}</span>
                                        </mat-list-item>
                                    </mat-list>
                                </div>
                            </div>

                            <div class="row hidden">

                                <div class="col-md-12">
                                    <mat-form-field appearance="outline" class="form-element">
                                        <mat-label>Name</mat-label>
                                        <input matInput placeholder="Name" value={{inputname}} formControlName="name">
                                    </mat-form-field>
                                </div>
                                <div class="col-md-4">
                                    <mat-form-field appearance="outline" class="form-element">
                                        <mat-label>Gender</mat-label>
                                        <input matInput placeholder="Gender" value={{inputgender}}
                                            formControlName="gender">
                                    </mat-form-field>
                                </div>
                                <div class="col-md-4">
                                    <mat-form-field appearance="outline" class="form-element">
                                        <mat-label>Age</mat-label>
                                        <input matInput type="number" placeholder="Age" value={{inputage}}
                                            formControlName="age">
                                    </mat-form-field>
                                </div>
                                <div class="col-md-4">
                                    <mat-form-field appearance="outline" class="form-element">
                                        <mat-label>Doctor Name</mat-label>
                                        <input matInput placeholder="Doctor Name" value={{inputdoctor}}
                                            formControlName="doctor_name">

                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="row my-4">

                                <div class="col-md-6">
                                    <ng-multiselect-dropdown [placeholder]="'Services'" [settings]="dropdownSettings"
                                        [data]="dropdownList" formControlName="labcharges" [(ngModel)]="selectedservice"
                                        (onSelect)="onItemSelect($event)" (onDeSelect)="onItemDeSelect($event)"
                                        (onSelectAll)="onSelectAll($event)">
                                    </ng-multiselect-dropdown>
                                </div>

                                <div class="col-md-6">
                                    <ng-multiselect-dropdown [placeholder]="'LabTests'" [settings]="dropdownTests"
                                        [data]="dropdowntestlist" formControlName="labtests"
                                        [(ngModel)]="selectedlabtest" (onSelect)="onItemSelect($event)"
                                        (onDeSelect)="onItemDeSelect($event)" (onSelectAll)="onSelectAll($event)"
                                        (onUnselectAll)="onUnselectAll($event)">
                                    </ng-multiselect-dropdown>
                                </div>


                                <div class="row my-3">



                                    <div class="col-md-6">
                                        <div class="my-2"
                                            style="border: 1px solid lightgray; border-radius: 5px; padding: 5px;">
                                            <div (click)="handleServiceDiscount()" class="vitals btn dropdown-toggle"
                                                mat-raised-button color="primary">{{ servicediscountString }}</div>
                                        </div>

                                    </div>

                                    <div class="col-md-6">
                                        <div class="my-2"
                                            style="border: 1px solid lightgray; border-radius: 5px; padding: 5px;">
                                            <div (click)="handleDiscount()" class="vitals btn dropdown-toggle"
                                                mat-raised-button color="primary">{{ discountString }}</div>
                                        </div>

                                    </div>


                                </div>



                                <div class="row mt-4 mx-auto">
                                    <div class="col-md-6">
                                        <mat-form-field appearance="outline" class="form-element">
                                            <mat-label>Payment Mode</mat-label>
                                            <mat-select placeholder="Payment Mode" value="{{inputpaymentmode}}"
                                                formControlName="paymentmode">
                                                <mat-option value="Cash">Cash</mat-option>
                                                <mat-option value="Card">Card</mat-option>
                                            </mat-select>
                                            <mat-error>
                                                {{ titleAlert }}
                                            </mat-error>
                                        </mat-form-field>
                                    </div>

                                    <div class="col-md-6">
                                        <mat-form-field appearance="outline" class="form-element">
                                            <mat-label>Payment</mat-label>
                                            <input matInput type="number" placeholder="Payment"
                                                formControlName="payment">
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row hidden">
                                    <div class="col-md-4">
                                        <mat-form-field appearance="outline" class="form-element">
                                            <mat-label>Sub Total</mat-label>
                                            <input type="number" matInput placeholder="SubTotal" value="{{subtotal}}"
                                                formControlName="subtotal">
                                        </mat-form-field>
                                    </div>
                                    <div class="col-md-4">
                                        <mat-form-field appearance="outline" class="form-element">
                                            <mat-label>Balance</mat-label>
                                            <input type="number" matInput placeholder="Balance" value="{{inputbalance}}"
                                                formControlName="subtotal">
                                        </mat-form-field>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 text-center">
                                        <h1 class="display-3"><strong>Sub Total: </strong><span>{{subtotal}}</span></h1>
                                    </div>
                                    <div class="col-md-6 text-center">
                                        <h1 class="display-3"><strong>Pending Amount:
                                            </strong><span>{{inputbalance}}</span>
                                        </h1>
                                    </div>
                                </div>
                            </div>
                        </mat-dialog-content>
                        <mat-dialog-actions class="text-center mx-auto mt-2">
                            <div class="row text-center mx-auto" style="width: 100%;">
                                <div class="col-md-6 mx-auto">
                                    <div class="form-element">
                                        <button mat-raised-button color="primary" type="submit" class="button"
                                            [mat-dialog-close]="true">Save</button>
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-success" role="alert" *ngIf="showSuccess">
                                User Created Successfully
                            </div>
                            <div class="alert alert-danger" role="alert" *ngIf="showError">
                                {{ errorString }}
                            </div>
                        </mat-dialog-actions>
                    </div>
                </form>


            </div>
        </mat-tab> -->
        <mat-tab>
            <ng-template mat-tab-label>
                <mat-icon class="example-tab-icon">receipt_long</mat-icon>
                Billing
            </ng-template>
            <div *ngIf="!post" novalidate>
                <form class="form mx-auto" [formGroup]="formGroup" (ngSubmit)="onSubmit(formGroup.value)">
                    <div class="container-fluid">
                        <mat-dialog-content>
                            <div class="row">
                                <div class="col-lg-8 col-md-12 col-sm-12">
                                    <div class="row hidden">

                                        <div class="col-md-12">
                                            <mat-form-field appearance="outline" class="form-element">
                                                <mat-label>Name</mat-label>
                                                <input matInput placeholder="Name" value={{inputname}}
                                                    formControlName="name">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-md-4">
                                            <mat-form-field appearance="outline" class="form-element">
                                                <mat-label>Gender</mat-label>
                                                <input matInput placeholder="Gender" value={{inputgender}}
                                                    formControlName="gender">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-md-4">
                                            <mat-form-field appearance="outline" class="form-element">
                                                <mat-label>Age</mat-label>
                                                <input matInput type="number" placeholder="Age" value={{inputage}}
                                                    formControlName="age">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-md-4">
                                            <mat-form-field appearance="outline" class="form-element">
                                                <mat-label>Doctor Name</mat-label>
                                                <input matInput placeholder="Doctor Name" value={{inputdoctor}}
                                                    formControlName="doctor_name">

                                            </mat-form-field>
                                        </div>
                                    </div>
                                    <div class="row hidden">
                                        <div class="col-md-4">
                                            <mat-form-field appearance="outline" class="form-element">
                                                <mat-label>Sub Total</mat-label>
                                                <input type="number" matInput placeholder="SubTotal"
                                                    value="{{subtotal}}" formControlName="subtotal">
                                            </mat-form-field>
                                        </div>
                                        <div class="col-md-4">
                                            <mat-form-field appearance="outline" class="form-element">
                                                <mat-label>Balance</mat-label>
                                                <input type="number" matInput placeholder="Balance"
                                                    value="{{inputbalance}}" formControlName="subtotal">
                                            </mat-form-field>
                                        </div>
                                        <mat-form-field appearance="outline" class="form-element">
                                            <mat-label>Payment</mat-label>
                                            <input matInput type="number" placeholder="Payment"
                                                formControlName="payment" value="{{subtotal}}">
                                        </mat-form-field>
                                    </div>
                                    <form [formGroup]="addingServices">
                                        <div class="row text-center mt-2 headingRow">
                                            <div class="col-md-3 col-sm-12">
                                                <strong>Service Name</strong>
                                            </div>
                                            <div class="col-md-3 col-sm-12">
                                                <strong>Unit Price</strong>
                                            </div>
                                            <div class="col-md-3 col-sm-12">
                                                <strong>Discount</strong>
                                            </div>
                                        </div>
                                        <div class="row text-center mt-2" *ngFor="let row of sArr; let i = index;">
                                            <div class="col-md-3 col-sm-12">
                                                {{ row.service }}
                                            </div>
                                            <div class="col-md-3 col-sm-12">
                                                {{ row.charges }}
                                            </div>
                                            <div class="col-md-3 col-sm-12">
                                                {{ row.discount }}
                                            </div>
                                            <div class="col-md-3 col-sm-12">
                                                <button mat-icon-button disabled type="button" (click)="deleteService(i)"
                                                    style="margin-top: -20px">
                                                    <mat-icon>delete</mat-icon>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="row text-center mt-2"
                                            *ngFor="let row of serviceArr; let i = index;">
                                            <div class="col-md-3 col-sm-12">
                                                {{ row.service }}
                                            </div>
                                            <div class="col-md-3 col-sm-12">
                                                {{ row.charges }}
                                            </div>
                                            <div class="col-md-3 col-sm-12">
                                                {{ row.discount }}
                                            </div>
                                            <div class="col-md-3 col-sm-12">
                                                <button mat-icon-button type="button" (click)="deleteService(i)"
                                                    style="margin-top: -20px">
                                                    <mat-icon class="redcolor">delete</mat-icon>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-3 col-sm-12">
                                                <mat-form-field appearance="fill" class="form-element">
                                                    <mat-label>Service Name</mat-label>
                                                    <mat-select formControlName="service"
                                                        (selectionChange)="priceValue($event)" [(ngModel)]="tempValue">
                                                        <mat-option *ngFor="let row of dropdownList"
                                                            [value]="row.service">
                                                            {{row.service}}
                                                        </mat-option>
                                                        <mat-option *ngFor="let row of dropdowntestlist"
                                                            [value]="row.labtest">
                                                            {{row.labtest}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-3 col-sm-12">
                                                <mat-form-field appearance="fill" class="form-element">
                                                    <mat-label>Unit Price</mat-label>
                                                    <input type="number" matInput placeholder="Unit Price"
                                                        value="{{selectedValue}}" formControlName="charges">
                                                </mat-form-field>
                                            </div>
                                            <div class="col-md-3 col-sm-12">
                                                <mat-form-field appearance="fill" class="form-element">
                                                    <mat-label>Discount</mat-label>
                                                    <input type="number" matInput placeholder="Discount"
                                                        formControlName="discount" [(ngModel)]="discountValue">
                                                    <span matSuffix>%</span>
                                                </mat-form-field>
                                            </div>

                                            <div class="col-md-3 col-sm-12">
                                                <button mat-raised-button color="primary" type="button" class="button"
                                                    style="margin-top: 16px"
                                                    (click)="handleAdd(addingServices.value)">Add</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <!-- <hr> -->
                                <!-- <mat-divider [vertical]="true"></mat-divider> -->
                                <div class="col-lg-4 col-md-12 col-sm-12 text-center" style="border-left:1px solid #C8C8C8;">
                                    <table class="table table-borderless" style="text-align: left">
                                        <tbody>

                                            <tr>
                                                <td scope="row" valign=middle>
                                                    <strong>Follow Up</strong>
                                                </td>
                                                <td>
                                                    <mat-icon *ngIf="followup == false" class="redcolor">close
                                                    </mat-icon>
                                                    <mat-icon *ngIf="followup == true" class="greencolor">check
                                                    </mat-icon>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="row" valign=middle>
                                                    <strong>Service Charge</strong>
                                                </td>
                                                <td>:
                                                    <!-- <button mat-icon-button color="primary">
                                                        <mat-icon class="greencolor" *ngIf="serviceSubtotal != 0">print
                                                        </mat-icon>
                                                        <mat-icon class="redcolor" *ngIf="serviceSubtotal == 0">print
                                                        </mat-icon>
                                                    </button> -->
                                                    {{ serviceSubtotal }}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="row" valign=middle>
                                                    <strong>Labtest Charge</strong>
                                                </td>
                                                <td>
                                                    :
                                                    <!-- <button mat-icon-button color="primary">
                                                        <mat-icon class="greencolor" *ngIf="labtestSubtotal != 0">print
                                                        </mat-icon>
                                                        <mat-icon class="redcolor" *ngIf="labtestSubtotal == 0">print
                                                        </mat-icon>
                                                    </button> -->
                                                    {{ labtestSubtotal }}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="row" valign=middle>
                                                    <strong>Previous Due</strong>
                                                </td>
                                                <td *ngIf="prevDue">
                                                    :
                                                    {{ prevDue }}
                                                </td>
                                                <td *ngIf="!prevDue">
                                                    : 0
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="row" valign="middle">
                                                    <strong>Discount</strong>
                                                </td>
                                                <td>
                                                    <mat-form-field appearance="fill"
                                                        style="width: 90%; margin-bottom: -20px">
                                                        <mat-label>Discount</mat-label>
                                                        <input type="number" matInput placeholder="Discount"
                                                            formControlName="totalDiscount"
                                                            (ngModelChange)="discountTot($event)">
                                                    </mat-form-field>
                                                    <div class="alert alert-danger" role="alert"
                                                        style="margin-top: 10px; width: 90%;" *ngIf="showDiscountError">
                                                        Discount Can't be larger than total amount!
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="row" valign=middle>
                                                    <strong>Total Charge</strong>
                                                </td>
                                                <td>
                                                    : â‚¹ {{subtotal}}
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="row" valign="middle">
                                                    <strong>Payment Mode</strong>
                                                </td>
                                                <td>
                                                    <mat-form-field appearance="fill"
                                                        style="width: 90%; margin-bottom: -20px">
                                                        <mat-label>Payment Mode</mat-label>
                                                        <mat-select placeholder="Payment Mode"
                                                            value="{{inputpaymentmode}}" formControlName="paymentmode">
                                                            <mat-option value="Cash">Cash</mat-option>
                                                            <mat-option value="Card">Credit Card</mat-option>
                                                            <mat-option value="Phonepe">PhonePe</mat-option>
                                                            <mat-option value="PayTM">PayTM</mat-option>
                                                            <mat-option value="GooglePay">Google Pay</mat-option>
                                                            <mat-option value="DebitCard">Debit Card</mat-option>
                                                        </mat-select>
                                                        <mat-error>
                                                            {{ titleAlert }}
                                                        </mat-error>
                                                    </mat-form-field>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td scope="row" valign="middle">
                                                    <strong>Payment</strong>
                                                </td>
                                                <td>
                                                    <mat-form-field appearance="outline"
                                                        style="width: 90%; margin-bottom: -20px">
                                                        <mat-label>Payment</mat-label>
                                                        <input matInput type="number" placeholder="Payment"
                                                            formControlName="payment" value="{{subtotal}}"
                                                            [(ngModel)]="payment">
                                                    </mat-form-field>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td colspan="2" align="center">
                                                    <mat-dialog-actions style="display: block">
                                                        <button mat-raised-button color="primary"
                                                            [mat-dialog-close]="true" type="submit">Pay</button>
                                                    </mat-dialog-actions>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </mat-dialog-content>
                        <!-- <mat-dialog-actions class="text-center mx-auto my-2">
                            <div class="row text-center mx-auto" style="width: 100%;">
                                <div class="col-md-6 mx-auto">
                                    <div class="form-element">
                                        <button mat-raised-button color="primary" type="submit" class="button"
                                            [mat-dialog-close]="true">Save</button>
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-success" role="alert" *ngIf="showSuccess">
                                User Created Successfully
                            </div>
                            <div class="alert alert-danger" role="alert" *ngIf="showError">
                                {{ errorString }}
                            </div>
                        </mat-dialog-actions> -->
                    </div>
                </form>


            </div>
        </mat-tab>
        <mat-tab>
            <ng-template mat-tab-label>
                <mat-icon class="example-tab-icon">undo</mat-icon>
                Refund
            </ng-template>
            <!-- <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 col-sm-12 mt-2">
                        <mat-form-field appearance="outline" class="form-element">
                            <mat-label>Amount</mat-label>
                            <input matInput [(ngModel)]="refundAmount">
                        </mat-form-field>
                    </div>
                    <div class="col-md-12 col-sm-12">
                        <mat-form-field appearance="outline" class="form-element">
                            <mat-label>Reason for Refund</mat-label>
                            <textarea matInput [(ngModel)]="refundReason"></textarea>
                        </mat-form-field>
                    </div>
                    <div class="col-md-12 col-sm-12 text-center mb-2">
                        <mat-dialog-actions style="display: block">
                            <button mat-raised-button color="primary" [mat-dialog-close]="true"
                                type="submit" (click)="refundFunc()">Refund</button>
                        </mat-dialog-actions>
                    </div>
                </div>
            </div> -->
            <!-- <table>
                <tr>
                    <th>Name</th>
                    <th>Services</th>
                    <th>Discount</th>
                    <th>Charges</th>
                    <th>Refund</th>
                </tr>
                <tr *ngFor="let patient of patientbills">
                    <td  *ngFor="let service of patient.discount">
                        <div>
                            {{service.service}}<br>
                        </div>
                    </td>
                    <td>{{patient.name}}</td>
                    <td>{{patient.name}}</td>
                    <td>{{patient.name}}</td>
                    <td>{{patient.name}}</td>
                </tr>
            </table> -->
        </mat-tab>
        <!-- <mat-tab>
            <ng-template mat-tab-label>
                <mat-icon class="example-tab-icon">payments</mat-icon>
                Transactions
            </ng-template>
            
        </mat-tab> -->
    </mat-tab-group>

</div>